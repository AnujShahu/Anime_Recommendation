<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Recommendation System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">

<!-- FLASH MESSAGES -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash-container">
      {% for message in messages %}
        <div class="flash-message">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- USER MENU -->
<div class="user-menu">
    <div class="settings-icon" id="userMenuBtn">
        {% if current_user.is_authenticated %}
            ğŸ‘¤
        {% else %}
            âš™
        {% endif %}
    </div>

    <div class="dropdown hidden" id="userDropdown">
        {% if current_user.is_authenticated %}
            <div class="dropdown-item">
                ğŸ‘‹ {{ current_user.username }}
            </div>

            <div class="dropdown-item">
                Role: {{ current_user.role }}
            </div>

            <div class="dropdown-item">
                <a href="{{ url_for('auth.logout') }}">Logout</a>
            </div>
        {% else %}
            <div class="dropdown-item" onclick="openLogin()">Login</div>
            <div class="dropdown-item" onclick="openRegister()">Register</div>
        {% endif %}
    </div>
</div>

<h1 class="title">ğŸŒ Anime Recommendation System</h1>

<button id="themeToggle" class="theme-toggle">ğŸŒ™ Dark Mode</button>

<!-- TABS -->
<div class="tabs">
    <button id="searchTab" class="tab active">Search by Name</button>
    <button id="genreTab" class="tab">Browse by Genre</button>
</div>

<!-- ================= SEARCH SECTION ================= -->
<div id="searchSection">

<form method="POST" id="searchForm">
    <div class="search-wrapper">
        <input type="text"
               id="searchInput"
               name="anime_name"
               placeholder="Search Anime..."
               autocomplete="off"
               required>

        <div id="suggestions" class="suggestions-box"></div>
    </div>

    <button type="submit" class="search-btn">Search</button>
</form>

<div id="loader" class="loader hidden"></div>

{% if error %}
<p class="error">{{ error }}</p>
{% endif %}

{% if anime %}
<div class="anime-card main-anime clickable-card"
     data-title="{{ anime.title }}">
    <img src="{{ anime.image_url }}" class="anime-img">
    <h2>{{ anime.title }}</h2>
    <p><strong>Genres:</strong> {{ anime.genres }}</p>
    <p><strong>Score:</strong> â­ {{ anime.score }}</p>
    <p><strong>Episodes:</strong> {{ anime.episodes }}</p>
</div>
{% endif %}

{% if recommendations %}
<h2 class="recommend-title">Recommended Anime</h2>

<div class="recommend-grid">
{% for rec in recommendations %}
    <div class="anime-card clickable-card"
         data-title="{{ rec.title }}">
        <img src="{{ rec.image_url }}" class="anime-img">
        <h3>{{ rec.title }}</h3>
        <p>{{ rec.genres }}</p>
        <p>â­ {{ rec.score }}</p>
    </div>
{% endfor %}
</div>
{% endif %}

</div>
<!-- END SEARCH SECTION -->


<!-- ================= GENRE SECTION ================= -->
<div id="genreSection" class="hidden">

    <h2 class="recommend-title">Browse by Genre</h2>

    <!-- Genre buttons load here dynamically -->
    <div id="genreContainer" class="genre-container"></div>

    <button id="genreSearchBtn" class="search-btn">
        Search by Selected Genres
    </button>

    <!-- Results load here -->
    <div id="genreResults" class="recommend-grid"></div>

</div>
<!-- END GENRE SECTION -->

</div> <!-- END CONTAINER -->


<!-- ================= LOGIN MODAL ================= -->
<div id="loginModal" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="closeLogin()">&times;</span>
        <h2>Login</h2>

        <form method="POST" action="{{ url_for('auth.login') }}">
            <input type="email" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="Password" required>
            <a href="#">Forgot Password?</a>
            <button type="submit" class="search-btn">Login</button>
        </form>
    </div>
</div>


<!-- ================= REGISTER MODAL ================= -->
<div id="registerModal" class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="closeRegister()">&times;</span>
        <h2>Register</h2>

        <form method="POST" action="{{ url_for('auth.register') }}">
            <input type="text" name="username" placeholder="Username" required>
            <input type="email" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit" class="search-btn">Register</button>
        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>